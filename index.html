<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atajos de Teclado</title>
    <style>
        :root {
            --gap: 8px;
            --key-size: 50px;
            --border-radius: 6px;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        /* Estilos para las teclas en la LISTA de atajos */
        .key {
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            margin: 0 2px;
            display: inline-block;
            font-weight: bold;
            color: white;
        }

        .ctrl { background-color: #3498db; }
        .shift { background-color: #9b59b6; }
        .alt { background-color: #e67e22; }
        .win { background-color: #2ecc71; }
        .regular { background-color: #34495e; } /* Para teclas normales en la lista */

        .keyboard-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .keyboard {
            display: inline-flex;
            flex-direction: column;
            background-color: #e0e0e0;
            padding: var(--gap);
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            gap: var(--gap);
            transform: perspective(1000px) rotateX(10deg);
        }

        .keyboard-row {
            display: flex;
            gap: var(--gap);
        }

        /* Estilos para las teclas del TECLADO VIRTUAL */
        .keyboard-key {
            width: var(--key-size);
            height: var(--key-size);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            /* Color base de teclas virtuales - ajustado para que el texto sea visible */
            background-color: #ffffff;
            color: #333333; /* Texto oscuro para teclas claras */
            font-weight: bold;
            font-family: 'Arial', sans-serif;
            cursor: pointer;
            box-shadow: 0 3px 0 rgba(0, 0, 0, 0.1);
            transition: transform 0.1s, box-shadow 0.1s;
            user-select: none;
            border: 1px solid #cccccc; /* Borde ligero para definición */
        }
        /* Colores específicos para teclas modificadoras en el TECLADO VIRTUAL */
        .keyboard-key.ctrl-virt { background-color: #3498db; color: white; }
        .keyboard-key.shift-virt { background-color: #9b59b6; color: white; }
        .keyboard-key.alt-virt { background-color: #e67e22; color: white; }
        .keyboard-key.win-virt { background-color: #2ecc71; color: white; }
        .keyboard-key.regular-virt { background-color: #ffffff; color: #333333; } /* Teclas normales virtuales */
        .keyboard-key.space-virt { background-color: #eeeeee; color: #333333; } /* Barra espaciadora */


        .keyboard-key.wide-2 { width: calc(var(--key-size) * 2 + var(--gap)); }
        .keyboard-key.wide-3 { width: calc(var(--key-size) * 3 + var(--gap) * 2); }
        .keyboard-key.wide-6 { width: calc(var(--key-size) * 6 + var(--gap) * 5); }

        .keyboard-key.active {
            /* Mantener tu animación original */
            animation: pulse 0.5s;
            /* Añadir también el efecto visual de presionado */
            transform: translateY(2px);
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
        }

        .shortcut-description {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            min-height: 24px;
            width: 80%; /* Ajustar ancho si es necesario */
            box-sizing: border-box;
        }

        .shortcuts-list {
            margin-top: 20px;
            width: 100%;
            max-width: 900px; /* Limitar ancho de la lista */
        }

        .shortcuts-list h3 {
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }

        .shortcuts-grid {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Ajustar minmax */
            gap: 10px; /* Ajustar gap */
            margin-bottom: 20px;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Para separar teclas y descripción */
            padding: 10px 15px; /* Ajustar padding */
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .shortcut-item:hover {
            background-color: #f0f0f0;
        }

        .shortcut-keys {
            /* margin-right: 10px; */ /* Quitado para usar justify-content */
            font-weight: bold;
            display: flex;
            align-items: center;
            flex-shrink: 0; /* Evitar que las teclas se encojan */
        }
        .shortcut-item-description {
             text-align: right;
             margin-left: 15px; /* Espacio entre teclas y descripción */
             color: #555;
             font-size: 0.9em;
         }

        @keyframes pulse {
            0% { transform: scale(1) translateY(0); box-shadow: 0 3px 0 rgba(0, 0, 0, 0.1); }
            50% { transform: scale(1.05) translateY(0); box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1); }
            100% { transform: scale(1) translateY(0); box-shadow: 0 3px 0 rgba(0, 0, 0, 0.1); }
        }

        /* Asegúrate que .active aplique el estado final presionado */
         .keyboard-key.active {
             transform: translateY(2px);
             box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
             /* La animación pulse se aplica al hacer clic */
         }


        .error-message {
            color: #e74c3c;
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            background-color: #fadbd8;
            border: 1px solid #f5b7b1;
            border-radius: 5px;
            display: none; /* Oculto por defecto */
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Atajos de Teclado</h2>

        <div class="keyboard-container">
            <div class="keyboard">
                <div class="keyboard-row">
                     <div class="keyboard-key regular-virt" data-key="Escape">Esc</div>
                     <div class="keyboard-key regular-virt" data-key="F1">F1</div>
                     <div class="keyboard-key regular-virt" data-key="F2">F2</div>
                     <div class="keyboard-key regular-virt" data-key="F3">F3</div>
                     <div class="keyboard-key regular-virt" data-key="F4">F4</div>
                     <div class="keyboard-key regular-virt" data-key="F5">F5</div>
                     <div class="keyboard-key regular-virt" data-key="F6">F6</div>
                     <div class="keyboard-key regular-virt" data-key="F7">F7</div>
                     <div class="keyboard-key regular-virt" data-key="F8">F8</div>
                     <div class="keyboard-key regular-virt" data-key="F9">F9</div>
                     <div class="keyboard-key regular-virt" data-key="F10">F10</div>
                     <div class="keyboard-key regular-virt" data-key="F11">F11</div>
                     <div class="keyboard-key regular-virt" data-key="F12">F12</div>
                 </div>
                 <div class="keyboard-row">
                     <div class="keyboard-key regular-virt" data-key="`">~`</div>
                     <div class="keyboard-key regular-virt" data-key="1">1</div>
                     <div class="keyboard-key regular-virt" data-key="2">2</div>
                     <div class="keyboard-key regular-virt" data-key="3">3</div>
                     <div class="keyboard-key regular-virt" data-key="4">4</div>
                     <div class="keyboard-key regular-virt" data-key="5">5</div>
                     <div class="keyboard-key regular-virt" data-key="6">6</div>
                     <div class="keyboard-key regular-virt" data-key="7">7</div>
                     <div class="keyboard-key regular-virt" data-key="8">8</div>
                     <div class="keyboard-key regular-virt" data-key="9">9</div>
                     <div class="keyboard-key regular-virt" data-key="0">0</div>
                     <div class="keyboard-key regular-virt" data-key="-">-</div>
                     <div class="keyboard-key regular-virt" data-key="=">=</div>
                     <div class="keyboard-key wide-2 regular-virt" data-key="Backspace">Back</div>
                 </div>
                 <div class="keyboard-row">
                     <div class="keyboard-key wide-2 regular-virt" data-key="Tab">Tab</div>
                     <div class="keyboard-key regular-virt" data-key="q">Q</div>
                     <div class="keyboard-key regular-virt" data-key="w">W</div>
                     <div class="keyboard-key regular-virt" data-key="e">E</div>
                     <div class="keyboard-key regular-virt" data-key="r">R</div>
                     <div class="keyboard-key regular-virt" data-key="t">T</div>
                     <div class="keyboard-key regular-virt" data-key="y">Y</div>
                     <div class="keyboard-key regular-virt" data-key="u">U</div>
                     <div class="keyboard-key regular-virt" data-key="i">I</div>
                     <div class="keyboard-key regular-virt" data-key="o">O</div>
                     <div class="keyboard-key regular-virt" data-key="p">P</div>
                     <div class="keyboard-key regular-virt" data-key="[">[</div>
                     <div class="keyboard-key regular-virt" data-key="]">]</div>
                     <div class="keyboard-key regular-virt" data-key="\">\\</div>
                 </div>
                 <div class="keyboard-row">
                     <div class="keyboard-key wide-2 regular-virt" data-key="CapsLock">Caps</div>
                     <div class="keyboard-key regular-virt" data-key="a">A</div>
                     <div class="keyboard-key regular-virt" data-key="s">S</div>
                     <div class="keyboard-key regular-virt" data-key="d">D</div>
                     <div class="keyboard-key regular-virt" data-key="f">F</div>
                     <div class="keyboard-key regular-virt" data-key="g">G</div>
                     <div class="keyboard-key regular-virt" data-key="h">H</div>
                     <div class="keyboard-key regular-virt" data-key="j">J</div>
                     <div class="keyboard-key regular-virt" data-key="k">K</div>
                     <div class="keyboard-key regular-virt" data-key="l">L</div>
                     <div class="keyboard-key regular-virt" data-key=";">;</div>
                     <div class="keyboard-key regular-virt" data-key="'">'</div>
                     <div class="keyboard-key wide-2 regular-virt" data-key="Enter">Enter</div>
                 </div>
                 <div class="keyboard-row">
                     <div class="keyboard-key wide-2 shift-virt" data-key="Shift">Shift</div>
                     <div class="keyboard-key regular-virt" data-key="z">Z</div>
                     <div class="keyboard-key regular-virt" data-key="x">X</div>
                     <div class="keyboard-key regular-virt" data-key="c">C</div>
                     <div class="keyboard-key regular-virt" data-key="v">V</div>
                     <div class="keyboard-key regular-virt" data-key="b">B</div>
                     <div class="keyboard-key regular-virt" data-key="n">N</div>
                     <div class="keyboard-key regular-virt" data-key="m">M</div>
                     <div class="keyboard-key regular-virt" data-key=",">,</div>
                     <div class="keyboard-key regular-virt" data-key=".">.</div>
                     <div class="keyboard-key regular-virt" data-key="/">/</div>
                     <div class="keyboard-key wide-2 shift-virt" data-key="Shift">Shift</div>
                 </div>
                 <div class="keyboard-row">
                     <div class="keyboard-key ctrl-virt" data-key="Control">Ctrl</div>
                     <div class="keyboard-key win-virt" data-key="Meta">Win</div>
                     <div class="keyboard-key alt-virt" data-key="Alt">Alt</div>
                     <div class="keyboard-key wide-6 space-virt" data-key=" ">Space</div>
                     <div class="keyboard-key alt-virt" data-key="Alt">Alt</div>
                     <div class="keyboard-key win-virt" data-key="Meta">Win</div>
                     <div class="keyboard-key regular-virt" data-key="ContextMenu">Menu</div>
                     <div class="keyboard-key ctrl-virt" data-key="Control">Ctrl</div>
                 </div>
            </div>
            <div id="shortcut-description" class="shortcut-description">
                </div>
        </div>

        <div class="shortcuts-list">
            <h3>Atajos Disponibles - Haz clic para demostrar</h3>
            <ul id="shortcuts-grid" class="shortcuts-grid">
                </ul>
        </div>

        <div id="error-message" class="error-message">
            </div>
    </div>

    <script>
        // Variable global para almacenar los atajos cargados
        let shortcuts = [];
        // Variable global para datos de ejemplo (si falla la carga)
        const defaultShortcuts = [
             { "hotkey": "+!r", "readable": "Shift+Alt+R", "description": "Atajo de ejemplo 1", "action": "" },
             { "hotkey": "^+s", "readable": "Ctrl+Shift+S", "description": "Atajo de ejemplo 2 (Guardar Como)", "action": "" },
             { "hotkey": "#space", "readable": "Win+Space", "description": "Atajo de ejemplo 3 (Cambiar Idioma)", "action": "" }
        ];

        const shortcutDescriptionElement = document.getElementById('shortcut-description');
        const shortcutsGridElement = document.getElementById('shortcuts-grid');
        const errorMessageElement = document.getElementById('error-message');

        // Mapeo de nombres 'readable' a data-key del teclado virtual
        const readableToDataKey = {
            'Shift': 'Shift',
            'Ctrl': 'Control',
            'Alt': 'Alt',
            'Win': 'Meta',
            'Space': ' ',
            'Esc': 'Escape',
            'Enter': 'Enter',
            'Tab': 'Tab',
            'CapsLock': 'CapsLock',
            'Backspace': 'Backspace',
            // Añadir más si es necesario (ej. flechas: 'ArrowUp', 'ArrowDown', etc.)
        };

        // Función para obtener el selector CSS de una tecla virtual basado en su nombre legible
        function getVirtualKeySelector(keyName) {
            const trimmedName = keyName.trim();
            // Usar mapeo para modificadores y teclas especiales
            if (readableToDataKey[trimmedName]) {
                return `.keyboard-key[data-key="${readableToDataKey[trimmedName]}"]`;
            }
            // Para teclas F1-F12
            if (/^F([1-9]|1[0-2])$/.test(trimmedName)) {
                 return `.keyboard-key[data-key="${trimmedName}"]`;
            }
            // Para letras, números y símbolos simples (asume que data-key está en minúsculas)
            if (trimmedName.length === 1) {
                return `.keyboard-key[data-key="${trimmedName.toLowerCase()}"]`;
            }
            // Fallback (si no coincide con nada anterior)
            console.warn("No se pudo mapear la tecla para el selector:", trimmedName);
            return `.keyboard-key[data-key="${trimmedName.toLowerCase()}"]`; // Intenta con minúsculas
        }


        // Función para resaltar una tecla virtual (aplicar clase 'active')
        function highlightKey(keySelector, active = true) {
            try {
                // Seleccionar potencialmente múltiples teclas (ej. Shift izquierdo y derecho)
                const keyElements = document.querySelectorAll(keySelector);
                if (keyElements.length === 0) {
                    console.warn(`Selector no encontró teclas virtuales: ${keySelector}`);
                    return;
                }
                keyElements.forEach(keyElement => {
                    if (active) {
                        keyElement.classList.add('active');
                        // Aplicar animación pulse directamente aquí si se desea al activar
                        keyElement.style.animation = 'none'; // Resetear animación para que se ejecute de nuevo
                        void keyElement.offsetWidth; // Reflow para reiniciar animación
                        keyElement.style.animation = 'pulse 0.5s';
                    } else {
                        keyElement.classList.remove('active');
                        keyElement.style.animation = ''; // Quitar animación al desactivar
                    }
                });
            } catch (e) {
                console.error(`Error con el selector CSS "${keySelector}": ${e}`);
            }
        }

        // Función para limpiar todos los resaltados del teclado virtual
        function clearAllHighlights() {
            document.querySelectorAll('.keyboard-key.active').forEach(key => {
                key.classList.remove('active');
                key.style.animation = ''; // Asegurarse de quitar la animación
            });
        }

        // Función para mostrar la descripción del atajo
        function showShortcutDescription(description) {
            shortcutDescriptionElement.textContent = description || ''; // Muestra descripción o limpia si está vacía
        }

        // Función para demostrar un atajo (modificada para usar 'readable')
        function demonstrateShortcut(shortcut) {
            clearAllHighlights(); // Limpiar resaltados previos
            showShortcutDescription(shortcut.description); // Mostrar la descripción del atajo actual

            // Parsear la cadena 'readable' para obtener las teclas individuales
            const keysToPress = shortcut.readable.split('+');
            let delay = 0;

            keysToPress.forEach(keyName => {
                const selector = getVirtualKeySelector(keyName);
                console.log(`Demostrando: ${keyName} -> Selector: ${selector}`); // Para depuración
                // Resaltar la tecla después de un pequeño retraso
                setTimeout(() => {
                    highlightKey(selector, true);
                }, delay);
                delay += 200; // Aumentar el retraso para la siguiente tecla
            });

            // Limpiar resaltado después de un tiempo
            setTimeout(() => {
                clearAllHighlights();
                // Opcional: Limpiar descripción después de otro tiempo
                // setTimeout(() => showShortcutDescription(''), 500);
            }, delay + 1000); // Mantener resaltado 1 segundo después de la última tecla
        }

        // Generar la lista de atajos (modificada para usar 'readable' y tu CSS)
        function generateShortcutsList() {
            shortcutsGridElement.innerHTML = ''; // Limpiar lista existente

            // Si 'shortcuts' está vacío (por error de carga o JSON vacío), mostrar error
            if (!shortcuts || shortcuts.length === 0) {
                errorMessageElement.textContent = "No se pudieron cargar los atajos o el archivo está vacío. Mostrando ejemplos.";
                errorMessageElement.style.display = 'block';
                shortcuts = defaultShortcuts; // Cargar los de ejemplo para que se vea algo
                // Si ni siquiera hay ejemplos, salimos
                if (!shortcuts || shortcuts.length === 0) return;
            } else {
                // Si se cargaron atajos, ocultar el mensaje de error
                errorMessageElement.style.display = 'none';
            }


            shortcuts.forEach((shortcut) => {
                // Validar que el atajo tenga las propiedades necesarias
                if (!shortcut.readable || typeof shortcut.description === 'undefined') {
                    console.warn('Atajo omitido por formato incorrecto:', shortcut);
                    return; // Saltar este atajo
                }

                const li = document.createElement('li');
                li.className = 'shortcut-item';

                // Contenedor para las teclas coloreadas
                const keysContainer = document.createElement('div');
                keysContainer.className = 'shortcut-keys';

                // Parsear 'readable' y crear spans coloreados
                const readableKeys = shortcut.readable.split('+');
                readableKeys.forEach((keyName, index) => {
                    const keySpan = document.createElement('span');
                    const trimmedKeyName = keyName.trim();
                    keySpan.textContent = trimmedKeyName;
                    keySpan.className = 'key'; // Clase base para estilos de la lista

                    // Asignar clase de color según el nombre de la tecla
                    const lowerKey = trimmedKeyName.toLowerCase();
                    if (lowerKey === 'ctrl') keySpan.classList.add('ctrl');
                    else if (lowerKey === 'shift') keySpan.classList.add('shift');
                    else if (lowerKey === 'alt') keySpan.classList.add('alt');
                    else if (lowerKey === 'win') keySpan.classList.add('win');
                    else keySpan.classList.add('regular'); // Para otras teclas

                    keysContainer.appendChild(keySpan);

                    // Agregar signo '+' entre teclas si no es la última
                    if (index < readableKeys.length - 1) {
                        const plus = document.createTextNode(' + ');
                        keysContainer.appendChild(plus);
                    }
                });

                // Span para la descripción
                const descriptionSpan = document.createElement('span');
                 descriptionSpan.className = 'shortcut-item-description'; // Clase para estilo
                descriptionSpan.textContent = shortcut.description;

                li.appendChild(keysContainer);
                li.appendChild(descriptionSpan);

                // Añadir evento de clic para demostrar el atajo
                li.addEventListener('click', () => demonstrateShortcut(shortcut));

                shortcutsGridElement.appendChild(li);
            });
        }


        // Cargar atajos desde el archivo JSON local (simplificado)
        async function loadShortcutsFromJSON() {
            // Nombre del archivo JSON esperado
            const jsonPath = 'hotkeys.json'; // Asegúrate que este sea el nombre correcto
            try {
                console.log(`Intentando cargar atajos desde: ${jsonPath}`);
                const response = await fetch(jsonPath);
                if (!response.ok) {
                    throw new Error(`Error HTTP ${response.status} al cargar ${jsonPath}`);
                }
                const data = await response.json();

                // Validar que sea un array
                if (Array.isArray(data)) {
                     console.log('JSON cargado correctamente:', data);
                     // Filtrar por si algún objeto no tiene 'readable' o 'description'
                     shortcuts = data.filter(item => item.readable && typeof item.description !== 'undefined');
                     if (shortcuts.length !== data.length) {
                         console.warn("Algunos atajos en el JSON fueron omitidos por formato incorrecto.");
                     }
                } else {
                     console.warn(`El archivo ${jsonPath} no contiene un array JSON válido.`);
                     shortcuts = []; // Establecer como array vacío si no es un array
                     throw new Error('El contenido del JSON no es un array.'); // Lanzar error para que lo capture el catch
                }
            } catch (error) {
                console.error('Error cargando o parseando atajos desde JSON:', error);
                shortcuts = []; // Asegurar que sea un array vacío en caso de error
                // El mensaje de error se mostrará en generateShortcutsList
            } finally {
                // Generar la lista (usará ejemplos si la carga falló)
                generateShortcutsList();
            }
        }

        // Iniciar la carga de atajos cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', loadShortcutsFromJSON);

        // --- Código Opcional: Eventos de clic en teclas virtuales ---
        // (Mantenido de tu código original para feedback visual al hacer clic)
        document.querySelectorAll('.keyboard-key').forEach(key => {
            key.addEventListener('mousedown', () => { // Usar mousedown/mouseup para mejor efecto visual
                 key.classList.add('active');
                 // Aplicar animación pulse al hacer clic
                 key.style.animation = 'none';
                 void key.offsetWidth; // Reflow
                 key.style.animation = 'pulse 0.5s';
            });
             key.addEventListener('mouseup', () => {
                 key.classList.remove('active');
                 // Opcional: quitar animación al soltar, o dejar que termine
                 // key.style.animation = '';
            });
             // Quitar estado activo si el mouse sale mientras está presionado
             key.addEventListener('mouseleave', () => {
                 key.classList.remove('active');
                 // key.style.animation = '';
             });
        });

    </script>
</body>
</html>
